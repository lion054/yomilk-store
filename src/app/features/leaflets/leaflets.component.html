<!-- Leaflets Page -->
<div class="min-h-screen bg-gray-50 pt-[180px] md:pt-[200px] pb-12">
  <div class="container mx-auto px-4 md:px-6">
    <!-- Breadcrumb -->
    <app-breadcrumb [items]="[{label: 'Leaflets & Specials', link: '/leaflets'}]"></app-breadcrumb>

    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-[dark] to-[#2a4d3f] rounded-3xl p-8 md:p-12 mb-8 text-white">
      <div class="max-w-2xl">
        <h1 class="text-3xl md:text-4xl font-bold mb-4">Leaflets & Specials</h1>
        <p class="text-white/80 text-lg">Browse our latest deals, weekly specials, and promotional catalogues. Don't miss out on amazing savings!</p>
      </div>
    </div>

    <!-- Filter Tabs -->
    <div class="flex flex-wrap gap-3 mb-8">
      @for (cat of categories; track cat) {
        <button
          (click)="setFilter($any(cat.value))"
        [class]="activeFilter === cat.value
          ? 'flex items-center gap-2 px-5 py-2.5 bg-[fresh-500] text-white font-semibold rounded-xl shadow-md'
          : 'flex items-center gap-2 px-5 py-2.5 bg-white text-gray-700 font-medium rounded-xl border border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-colors'">
          <span>{{ cat.icon }}</span>
          {{ cat.label }}
        </button>
      }
    </div>

    <!-- Loading State -->
    @if (isLoading) {
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (i of [1,2,3,4,5,6]; track i) {
          <div class="bg-white rounded-2xl overflow-hidden shadow-sm animate-pulse">
            <div class="aspect-[3/4] bg-gray-200"></div>
            <div class="p-4 space-y-3">
              <div class="h-5 bg-gray-200 rounded w-3/4"></div>
              <div class="h-4 bg-gray-200 rounded w-full"></div>
              <div class="h-4 bg-gray-200 rounded w-1/2"></div>
            </div>
          </div>
        }
      </div>
    }

    <!-- Empty State -->
    @if (!isLoading && filteredLeaflets.length === 0) {
      <div class="bg-white rounded-2xl shadow-sm p-12 text-center">
        <div class="w-24 h-24 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center">
          <span class="text-5xl">ðŸ“„</span>
        </div>
        <h2 class="text-xl font-semibold text-gray-900 mb-2">No leaflets found</h2>
        <p class="text-gray-500 mb-6">There are no leaflets in this category at the moment.</p>
        <button (click)="setFilter('all')" class="inline-flex items-center gap-2 px-6 py-3 bg-[fresh-500] hover:bg-[#3a9a4d] text-white font-semibold rounded-xl transition-colors">
          View All Leaflets
        </button>
      </div>
    }

    <!-- Leaflets Grid -->
    @if (!isLoading && filteredLeaflets.length > 0) {
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (leaflet of filteredLeaflets; track leaflet) {
          <div
            class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 group cursor-pointer border border-gray-100"
            (click)="openLeaflet(leaflet)">
            <!-- Thumbnail -->
            <div class="relative aspect-[3/4] bg-gradient-to-br from-gray-100 to-gray-200 overflow-hidden">
              <!-- Placeholder Image (since actual images don't exist) -->
              <div class="absolute inset-0 flex flex-col items-center justify-center p-6 bg-gradient-to-br"
               [ngClass]="{
                 'from-orange-100 to-orange-200': leaflet.category === 'weekly-specials',
                 'from-purple-100 to-purple-200': leaflet.category === 'promotions',
                 'from-green-100 to-green-200': leaflet.category === 'seasonal',
                 'from-blue-100 to-blue-200': leaflet.category === 'catalogue'
               }">
                <span class="text-6xl mb-4">
                  {{ leaflet.category === 'weekly-specials' ? 'ðŸ”¥' :
                  leaflet.category === 'promotions' ? 'ðŸŽ‰' :
                  leaflet.category === 'seasonal' ? 'ðŸŒŸ' : 'ðŸ“–' }}
                </span>
                <span class="text-2xl font-bold text-gray-800 text-center">{{ leaflet.title }}</span>
                <span class="text-sm text-gray-600 mt-2">Click to view</span>
              </div>
              <!-- Validity Badge -->
              <div class="absolute top-3 left-3 flex items-center gap-1.5 bg-white/95 backdrop-blur-sm px-3 py-1.5 rounded-full shadow-sm">
                <span class="w-2 h-2 rounded-full"
                  [ngClass]="{
                    'bg-green-500': getDaysRemaining(leaflet) > 3,
                    'bg-yellow-500': getDaysRemaining(leaflet) <= 3 && getDaysRemaining(leaflet) > 0,
                    'bg-red-500': getDaysRemaining(leaflet) === 0
                  }"></span>
                <span class="text-xs font-medium text-gray-700">
                  {{ getDaysRemaining(leaflet) > 0 ? getDaysRemaining(leaflet) + ' days left' : 'Ends today!' }}
                </span>
              </div>
              <!-- Hover Overlay -->
              <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                <div class="flex gap-3">
                  <button class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="dark" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                  </button>
                  <button (click)="downloadLeaflet(leaflet); $event.stopPropagation()" class="w-12 h-12 bg-[fresh-500] rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                      <polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            <!-- Info -->
            <div class="p-4">
              <div class="flex items-center gap-2 mb-2">
                <span class="text-xs font-semibold px-2 py-1 rounded-full"
                  [ngClass]="{
                    'bg-orange-100 text-orange-700': leaflet.category === 'weekly-specials',
                    'bg-purple-100 text-purple-700': leaflet.category === 'promotions',
                    'bg-green-100 text-green-700': leaflet.category === 'seasonal',
                    'bg-blue-100 text-blue-700': leaflet.category === 'catalogue'
                  }">
                  {{ leaflet.category === 'weekly-specials' ? 'Weekly' :
                  leaflet.category === 'promotions' ? 'Promo' :
                  leaflet.category === 'seasonal' ? 'Seasonal' : 'Catalogue' }}
                </span>
              </div>
              <h3 class="font-semibold text-gray-900 mb-1 group-hover:text-[fresh-500] transition-colors">{{ leaflet.title }}</h3>
              <p class="text-sm text-gray-500 line-clamp-2">{{ leaflet.description }}</p>
              <p class="text-xs text-gray-400 mt-3">
                Valid: {{ leaflet.validFrom | date:'MMM d' }} - {{ leaflet.validUntil | date:'MMM d, yyyy' }}
              </p>
            </div>
          </div>
        }
      </div>
    }

    <!-- Back to Shop -->
    <div class="mt-12 text-center">
      <a routerLink="/store" class="inline-flex items-center gap-2 text-[fresh-500] hover:text-[#3a9a4d] font-medium transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m12 19-7-7 7-7"/><path d="M19 12H5"/>
        </svg>
        Continue Shopping
      </a>
    </div>
  </div>
</div>

<!-- Leaflet Viewer Modal -->
@if (selectedLeaflet) {
  <div class="fixed inset-0 z-[2000] bg-black/80 flex items-center justify-center p-4" (click)="closeViewer()">
    <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-4 border-b border-gray-200">
        <div>
          <h2 class="font-bold text-lg text-gray-900">{{ selectedLeaflet.title }}</h2>
          <p class="text-sm text-gray-500">Valid until {{ selectedLeaflet.validUntil | date:'MMMM d, yyyy' }}</p>
        </div>
        <div class="flex items-center gap-2">
          <button (click)="downloadLeaflet(selectedLeaflet)" class="flex items-center gap-2 px-4 py-2 bg-[fresh-500] text-white rounded-lg hover:bg-[#3a9a4d] transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>
            </svg>
            Download PDF
          </button>
          <button (click)="closeViewer()" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded-lg transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
            </svg>
          </button>
        </div>
      </div>
      <!-- Modal Content (Placeholder) -->
      <div class="aspect-[3/4] max-h-[70vh] overflow-auto bg-gray-100 flex items-center justify-center">
        <div class="text-center p-12">
          <span class="text-8xl block mb-6">
            {{ selectedLeaflet.category === 'weekly-specials' ? 'ðŸ”¥' :
            selectedLeaflet.category === 'promotions' ? 'ðŸŽ‰' :
            selectedLeaflet.category === 'seasonal' ? 'ðŸŒŸ' : 'ðŸ“–' }}
          </span>
          <h3 class="text-2xl font-bold text-gray-800 mb-2">{{ selectedLeaflet.title }}</h3>
          <p class="text-gray-600 mb-6 max-w-md mx-auto">{{ selectedLeaflet.description }}</p>
          <p class="text-sm text-gray-500">PDF viewer placeholder - In production, the actual PDF would display here.</p>
          <button (click)="downloadLeaflet(selectedLeaflet)" class="mt-6 inline-flex items-center gap-2 px-6 py-3 bg-[fresh-500] text-white rounded-xl hover:bg-[#3a9a4d] transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/>
            </svg>
            Download Full PDF
          </button>
        </div>
      </div>
    </div>
  </div>
}
